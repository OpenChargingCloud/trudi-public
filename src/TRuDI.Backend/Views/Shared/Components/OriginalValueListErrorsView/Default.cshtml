@using TRuDI.Backend.Utils
@using TRuDI.Models
@model OriginalValueList
    
<h3>Übersicht über fehlende Messwerte und Stati</h3>    

    
    @{
        var errorList = Model.GetErrorsList();
    }
    
    @if (!errorList.Any(e => e.HasErrors))
    {
        <div>
            Es wurden keine fehlenden Messwerte oder Messwerte mit Fehler-Status gefunden.
        </div>
    }
    else
    {
        <table class="table-condensed">
            <tr>
                <th>Tag</th>
                <th>Status</th>
                <th>Fehlende Messwerte</th>
            </tr>
            @foreach (var entry in errorList)
            {
                if (!entry.HasErrors)
                {
                    continue;
                }

                var timestamp = entry.Timestamp;
                if (timestamp < Model.Start)
                {
                    timestamp = Model.Start;
                }

                <tr>
                    <td><a style="cursor: pointer;" onclick="selectOvlDay('@Model.GetOriginalValueListIdent()', moment('@timestamp.ToIso8601()'));">@entry.Timestamp.ToString("dd.MM.yyyy")</a></td>
                    <td>
                        @if (entry.OkCount == entry.ValueCount)
                        {
                            <span>keine Fehler</span>
                        }
                        else
                        {
                            if (entry.FatalErrorCount > 0)
                            {
                                <div>
                                    <span>
                                        <i class="fa fa-times-circle"></i>
                                        @entry.FatalErrorCount @(entry.FatalErrorCount == 1 ? "fataler Fehler" : "fatale Fehler")
                                    </span>
                                </div>
                            }

                            if (entry.TempError1Count > 0)
                            {
                                <div>
                                    <span>
                                        <i class="fa fa-exclamation-circle"></i>
                                        @(entry.TempError1Count) @(entry.TempError1Count == 1 ? "temporärer Fehler 1" : "temporäre Fehler 1")
                                    </span>
                                </div>
                            }

                            if (entry.TempError2Count > 0)
                            {
                                <div>
                                    <span>
                                        <i class="fa fa-exclamation-triangle"></i>
                                        @(entry.TempError2Count) @(entry.TempError2Count == 1 ? "temporärer Fehler 2" : "temporäre Fehler 2")
                                    </span>
                                </div>
                            }

                            if (entry.WarningCount > 0)
                            {
                                <div>
                                    <span>
                                        <i class="fa fa-check-circle"></i>
                                        @entry.WarningCount @(entry.WarningCount == 1 ? "Warnung" : "Warnungen")
                                    </span>
                                </div>
                            }
                        }
                    </td>

                    <td>
                        @if (entry.GapCount == 0)
                        {
                            <text>keine</text>
                        }
                        else
                        {
                            @entry.GapCount
                            <text> Werte</text>
                        }
                    </td>
                </tr>
            }

        </table>
    }